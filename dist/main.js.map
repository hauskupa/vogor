{
  "version": 3,
  "sources": ["../src/mixer.js", "../src/main.js"],
  "sourcesContent": ["// src/mixer.js\r\n\r\nexport function setupMixer() {\r\n  const audioPlayer = {\r\n    tracks: {},\r\n    audioContext: null,\r\n    isPlaying: false,\r\n\r\n    loadSong(songElement) {\r\n      this.stopAllTracks();\r\n      this.tracks = {};\r\n\r\n      const songId = songElement.getAttribute(\"data-song\");\r\n      if (!songId) {\r\n        console.error(\"Song ID not found\");\r\n        return;\r\n      }\r\n\r\n      if (!this.audioContext) {\r\n        this.audioContext =\r\n          new (window.AudioContext || window.webkitAudioContext)();\r\n        console.log(\"AudioContext initialized\");\r\n      }\r\n\r\n      const trackElements = songElement.querySelectorAll(\"[data-track-url]\");\r\n      trackElements.forEach((trackElement) => {\r\n        const trackId = trackElement.getAttribute(\"data-track-id\");\r\n        const trackUrl = trackElement.getAttribute(\"data-track-url\");\r\n\r\n        if (!trackUrl) return;\r\n\r\n        if (!this.tracks[trackId]) {\r\n          const audioElement = new Audio(trackUrl);\r\n          audioElement.crossOrigin = \"anonymous\";\r\n\r\n          try {\r\n            const audioSource =\r\n              this.audioContext.createMediaElementSource(audioElement);\r\n            const panner = this.audioContext.createStereoPanner();\r\n\r\n            audioSource.connect(panner);\r\n            panner.connect(this.audioContext.destination);\r\n            console.log(`Track ${trackId} audio nodes connected`);\r\n\r\n            this.tracks[trackId] = {\r\n              element: trackElement,\r\n              audio: audioElement,\r\n              panner,\r\n              volumeControl: trackElement.querySelector(\r\n                \"[data-volume-control]\"\r\n              ),\r\n              panControl: trackElement.querySelector(\"[data-pan-control]\"),\r\n              muteButton: trackElement.querySelector(\"[data-mute-button]\"),\r\n              soloButton: trackElement.querySelector(\"[data-solo-button]\"),\r\n            };\r\n\r\n            this.initTrackControls(trackId);\r\n          } catch (err) {\r\n            console.error(\r\n              `Failed to initialize audio track ${trackId}: ${err.message}`\r\n            );\r\n          }\r\n        }\r\n      });\r\n    },\r\n\r\n    initTrackControls(trackId) {\r\n      const track = this.tracks[trackId];\r\n\r\n      if (!track) {\r\n        console.error(`Track ID ${trackId} not found or not loaded.`);\r\n        return;\r\n      }\r\n\r\n      // Volume\r\n      if (track.volumeControl && track.audio) {\r\n        track.volumeControl.addEventListener(\"input\", (e) => {\r\n          const volume = parseFloat(e.target.value);\r\n          track.audio.volume = volume;\r\n          console.log(`Track ${trackId} volume set to: ${volume}`);\r\n        });\r\n        track.audio.volume = track.volumeControl.value;\r\n      }\r\n\r\n      // Pan\r\n      if (track.panControl && track.panner) {\r\n        track.panControl.addEventListener(\"input\", (e) => {\r\n          const panValue = parseFloat(e.target.value);\r\n          track.panner.pan.value = panValue;\r\n          console.log(`Track ${trackId} panned to: ${panValue}`);\r\n        });\r\n      }\r\n\r\n      // Mute\r\n      if (track.muteButton) {\r\n        track.muteButton.addEventListener(\"click\", () => {\r\n          track.audio.muted = !track.audio.muted;\r\n          track.muteButton.classList.toggle(\"mute-active\", track.audio.muted);\r\n        });\r\n      }\r\n\r\n      // Solo\r\n      if (track.soloButton) {\r\n        track.soloButton.addEventListener(\"click\", () => {\r\n          const isSoloActive =\r\n            track.soloButton.classList.contains(\"solo-active\");\r\n\r\n          for (let id in this.tracks) {\r\n            const otherTrack = this.tracks[id];\r\n            if (id !== trackId) {\r\n              otherTrack.audio.muted = !isSoloActive;\r\n            }\r\n          }\r\n\r\n          track.soloButton.classList.toggle(\"solo-active\", !isSoloActive);\r\n        });\r\n      }\r\n    },\r\n\r\n    playAllTracks() {\r\n      const promises = [];\r\n\r\n      for (let trackId in this.tracks) {\r\n        const track = this.tracks[trackId];\r\n        const promise = new Promise((resolve) => {\r\n          track.audio.addEventListener(\"canplaythrough\", () => {\r\n            console.log(`Track ${trackId} ready to play`);\r\n            resolve();\r\n          });\r\n        });\r\n        promises.push(promise);\r\n      }\r\n\r\n      Promise.all(promises)\r\n        .then(() => {\r\n          console.log(\"All tracks are ready. Playing now...\");\r\n          for (let trackId in this.tracks) {\r\n            const track = this.tracks[trackId];\r\n            track.audio\r\n              .play()\r\n              .then(() => console.log(`Playing track ${trackId}`))\r\n              .catch((err) =>\r\n                console.error(\r\n                  `Error playing track ${trackId}: ${err.message}`\r\n                )\r\n              );\r\n          }\r\n          this.isPlaying = true;\r\n        })\r\n        .catch((err) => {\r\n          console.error(\"Error preparing tracks for playback:\", err);\r\n        });\r\n    },\r\n\r\n    stopAllTracks() {\r\n      for (let trackId in this.tracks) {\r\n        const track = this.tracks[trackId];\r\n        track.audio.pause();\r\n        track.audio.currentTime = 0;\r\n      }\r\n      this.isPlaying = false;\r\n    },\r\n  };\r\n\r\n  // Play buttons\r\n  document.querySelectorAll(\"[data-play-button]\").forEach((button) => {\r\n    button.addEventListener(\"click\", () => {\r\n      const songElement = button.closest(\".track-controls\");\r\n\r\n      if (audioPlayer.isPlaying) {\r\n        audioPlayer.stopAllTracks();\r\n        button.classList.remove(\"playing\");\r\n      } else {\r\n        audioPlayer.loadSong(songElement);\r\n\r\n        if (\r\n          audioPlayer.audioContext &&\r\n          audioPlayer.audioContext.state === \"suspended\"\r\n        ) {\r\n          audioPlayer.audioContext\r\n            .resume()\r\n            .then(() => console.log(\"AudioContext resumed\"))\r\n            .catch((err) =>\r\n              console.error(`Error resuming AudioContext: ${err.message}`)\r\n            );\r\n        }\r\n\r\n        audioPlayer.playAllTracks();\r\n        button.classList.add(\"playing\");\r\n        updateSongProgress(songElement);\r\n      }\r\n    });\r\n  });\r\n\r\n  function updateSongProgress(songElement) {\r\n    const firstTrack = songElement.querySelector(\"[data-track-url]\");\r\n    if (!firstTrack) return;\r\n\r\n    const firstTrackId = firstTrack.getAttribute(\"data-track-id\");\r\n    const track = audioPlayer.tracks[firstTrackId];\r\n    if (!track) return;\r\n\r\n    const audio = track.audio;\r\n    const progressBar = songElement.querySelector(\"[data-progress-bar]\");\r\n\r\n    if (!progressBar) return;\r\n\r\n    audio.addEventListener(\"timeupdate\", () => {\r\n      if (audio.duration) {\r\n        const progress = (audio.currentTime / audio.duration) * 100;\r\n        progressBar.value = progress;\r\n      }\r\n    });\r\n\r\n    progressBar.addEventListener(\"input\", (e) => {\r\n      if (!audio.duration) return;\r\n      const newTime = (e.target.value / 100) * audio.duration;\r\n      for (let id in audioPlayer.tracks) {\r\n        audioPlayer.tracks[id].audio.currentTime = newTime;\r\n      }\r\n    });\r\n  }\r\n}\r\n", "import { setupMixer } from \"./mixer.js\";\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n  if (document.querySelector(\"[data-mixer]\")) {\r\n    console.log(\"Found mixer element, initializing...\");\r\n    setupMixer();\r\n  }\r\n});\r\n"],
  "mappings": "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",
  "names": ["setupMixer", "audioPlayer", "songElement", "trackElement", "trackId", "trackUrl", "audioElement", "audioSource", "panner", "err", "track", "e", "volume", "panValue", "isSoloActive", "id", "otherTrack", "promises", "promise", "resolve", "button", "updateSongProgress", "firstTrack", "firstTrackId", "audio", "progressBar", "progress", "newTime", "setupMixer"]
}
